## 总体目标
- 全面消除高危硬伤（认证绕过、弱密钥、过宽 CORS、缺少限流）
- 提升后端可靠性（事务化、分页与搜索下推、异步队列化重负载）
- 强化前端稳定性（错误边界、列表虚拟化、认证流程一致性）
- 建立基础测试与CI，形成可持续的质量门槛

## 安全加固
1. 移除生产环境的 `X-Dev-Mode` 旁路；将开发旁路受 `NODE_ENV` 和显式开关控制
2. 强制 `JWT_SECRET` 配置，不再使用 `'your-secret-key'` 回退；增加 `issuer/audience`
3. 收紧 CORS 白名单，移除 `*.vercel.app` 通配；仅保留必要域名，审查 `credentials: true`
4. 登录与上传接口增加速率限制（全局+路由级）；登录失败次数节流与临时封禁
5. 登录流程引入验证码（前端集成、后端验证）；仅在高风险触发时强制
6. 清理仓库与部署环境中的真实 `.env`；仅保留 `.env.example` 模板

## 后端可靠性与性能
1. 将缩略图、`ffprobe`、PDF导出等CPU/IO密集流程移入异步队列（如 Bull）
2. 为 `videos/projects/search/shares` 等列表统一分页与总数返回；全局搜索改为DB侧 `ILIKE/全文检索`
3. 为批量打标、清理任务改造为批量 SQL 与限速队列，减少 N+1
4. 在多步写入服务（项目创建、批注写入等）加入事务，并处理审计日志一致性
5. 补充常用组合索引（例：`videos(project_id, base_name, version)`、`videos(deleted_at)`）
6. 上传链路增加类型白名单、配额检查、病毒扫描；探索分片/流式上传

## 前端稳定性与体验
1. 在根应用添加全局 `ErrorBoundary`；模块级可选边界
2. 对大型列表引入虚拟化（react-window等）、分页、项级 `React.memo`；关键计算使用 `useMemo/useCallback`
3. 修复 `authApi.register` 缺失；移除隐式硬编码登录逻辑，改为角色校验
4. 优化 `apiClient`：严格依赖 `VITE_API_BASE_URL`；token 恢复兜底；必要时保留响应头通道
5. 适度持久化关键 UI 态（检索条件、工作台视图）

## 测试与CI
1. 后端：为 `auth/projects/users` 等核心服务与控制器补充单元/集成测试（Nest Testing + supertest）
2. 前端：引入 `vitest` + `@testing-library/react`，为 `useAuth` 与登录页补最小用例
3. E2E：初始化 Playwright，覆盖登录→项目列表最小路径
4. CI：创建 GitHub Actions（安装、lint、build、unit、e2e、coverage）；设置分支保护

## 数据库与运维
1. 保持 `synchronize: false`；通过 CLI 迁移管理结构变更
2. 审核运维脚本的动态 SQL，继续确保来源受控；如需外参，加入严格校验
3. 生产启用严格 SSL 校验，避免 `rejectUnauthorized=false`

## 交付顺序（从高到低优先）
- P0：认证旁路、JWT密钥、CORS收紧、限流/验证码、移除真实 .env
- P1：异步队列化重负载、分页与搜索下推、事务化、索引补强
- P2：前端错误边界与虚拟化、API 客户端与注册修复、UI 态持久化
- P3：测试与CI基线、运维脚本安全化、上传安全增强