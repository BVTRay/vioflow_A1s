# 数据加载问题排查指南

## 🔍 问题：页面上看不到任何数据

### 可能的原因

1. **没有当前团队**
   - 检查浏览器控制台是否有 "⚠️ 没有当前团队，跳过数据加载"
   - 解决方案：确保用户已加入团队或创建团队

2. **teamId 没有正确传递**
   - 检查浏览器控制台是否有 "⚠️ API 请求: 没有 teamId"
   - 检查是否有 "📤 API 请求: 添加 teamId=xxx"
   - 解决方案：确保 `apiClient.setTeamId()` 被正确调用

3. **后端查询返回空数组**
   - 检查浏览器控制台是否有 "📥 收到项目列表: 0 个项目"
   - 检查后端日志是否有 "[ProjectsService] 找到 0 个项目"
   - 可能原因：
     - 该团队确实没有项目
     - 项目的 team_id 不匹配
     - RLS 策略过滤了数据

4. **数据加载完成但 state 没有更新**
   - 检查浏览器控制台是否有 "✅ 数据加载完成"
   - 检查是否有 "📊 更新应用状态"
   - 如果都没有，可能是 useEffect 依赖问题

## 🛠️ 排查步骤

### 步骤 1：检查团队状态

打开浏览器控制台，查看是否有以下日志：

```
🔄 开始加载团队列表...
✅ 加载到团队: X 个 [团队名称列表]
✅ 设置默认团队: [团队名称] [团队ID]
✅ 当前团队已设置: [团队名称] [团队ID]
```

如果没有看到这些日志，说明团队加载有问题。

### 步骤 2：检查数据加载

查看是否有以下日志：

```
🔄 开始加载数据，当前团队: [团队ID] [团队名称]
📡 请求项目列表: { filters, currentTeamId, params }
📤 API 请求 [GET /projects]: 添加 teamId=[团队ID]
📥 收到项目列表: X 个项目
✅ 数据加载完成: { projects: X, videos: X, ... }
📊 更新应用状态: { projects: X, videos: X, ... }
```

### 步骤 3：检查后端日志

查看后端控制台是否有：

```
[ProjectsService] 查询项目，团队 ID: [团队ID]
[ProjectsService] 找到 X 个项目
```

### 步骤 4：检查数据库

如果后端日志显示找到了项目，但前端收到 0 个，可能是：
- 数据转换问题
- 网络请求被拦截
- API 响应格式不匹配

## 🔧 快速修复

### 如果看不到任何日志

1. 检查浏览器控制台是否打开
2. 检查是否有 JavaScript 错误
3. 刷新页面重新加载

### 如果没有当前团队

1. 检查用户是否已登录
2. 检查用户是否已加入团队
3. 如果没有团队，会显示团队引导页面

### 如果 teamId 没有传递

1. 检查 `localStorage.getItem('current_team_id')` 是否有值
2. 检查 `apiClient.getTeamId()` 是否返回正确的值
3. 手动设置：`apiClient.setTeamId('团队ID')`

### 如果后端返回空数组

1. 检查数据库中是否有项目数据
2. 检查项目的 `team_id` 是否匹配当前团队
3. 检查 RLS 策略是否正确配置

## 📝 临时解决方案

如果问题持续，可以临时禁用 teamId 过滤进行测试：

```typescript
// 在 projectsApi.getAll() 中临时注释掉 teamId
const params = { ...filters }; // 不添加 teamId
```

**注意**：这只是用于排查问题，生产环境必须使用 teamId 过滤。

